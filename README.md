# **Тестовое задание для стажёра Backend-направления (зимняя волна 2025)**

## Магазин мерча

В Авито существует внутренний магазин мерча, где сотрудники могут приобретать товары за монеты (coin). Каждому новому сотруднику выделяется 1000 монет, которые можно использовать для покупки товаров. Кроме того, монеты можно передавать другим сотрудникам в знак благодарности или как подарок.

## Описание задачи

Необходимо реализовать сервис, который позволит сотрудникам обмениваться монетками и приобретать на них мерч. Каждый сотрудник должен иметь возможность видеть:

- Список купленных им мерчовых товаров  
- Сгруппированную информацию о перемещении монеток в его кошельке, включая:  
  - Кто ему передавал монетки и в каком количестве  
  - Кому сотрудник передавал монетки и в каком количестве

Количество монеток не может быть отрицательным, запрещено уходить в минус при операциях с монетками.

## **Общие вводные**

**Мерч** — это продукт, который можно купить за монетки. Всего в магазине доступно 10 видов мерча. Каждый товар имеет уникальное название и цену. Ниже приведён список наименований и их цены.

| Название     | Цена |
|--------------|------|
| t-shirt      | 80   |
| cup          | 20   |
| book         | 50   |
| pen          | 10   |
| powerbank    | 200  |
| hoody        | 300  |
| umbrella     | 200  |
| socks        | 10   |
| wallet       | 50   |
| pink-hoody   | 500  |

Предполагается, что в магазине бесконечный запас каждого вида мерча.


## **Условия**

* Используйте этот [API](https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Backend/Backend-trainee-assignment-winter-2025/schema.json) 
* Сотрудников может быть до 100к, RPS — 1k, SLI времени ответа — 50 мс, SLI успешности ответа — 99.99%   
* Для авторизации доступов должен использоваться JWT. Пользовательский токен доступа к API  выдается после авторизации/регистрации пользователя. При первой авторизации пользователь должен создаваться автоматически.
* Реализуйте покрытие бизнес сценариев юнит-тестами. Общее тестовое покрытие проекта должно превышать 40%
* Реализуйте интеграционный или E2E-тест на сценарий покупки мерча  
* Реализуйте интеграционный или E2E-тест на сценарий передачи монеток другим сотрудникам


## **Дополнительные задания**

Эти задания не являются обязательными, но выполнение всех или части из них даст вам преимущество перед другими кандидатами.  

* Провести нагрузочное тестирование полученного решения и приложить результаты тестирования 
* Реализовать интеграционное или E2E-тестирование для остальных сценариев  
* Описать конфигурацию линтера (.golangci.yaml в корне проекта для go, phpstan.neon для PHP или ориентируйтесь на свои, если используете другие ЯП для выполнения тестового)

## **Стек**

**Язык сервиса:** Go
 
**База данных:** PostgreSQL
 
Для **деплоя зависимостей и самого сервиса** используется Docker Compose. Порт доступа к сервису 8080 и доступен снаружи как `localhost:8080`.


![backend_uml](./docs/backend_uml.svg)

Какие выбрать сущности
Надо делать транзакцию при переводе монет и покупке мерча

Дилемма:
Сделать избыточность в таблице bought_merchs в виде атрибута merch_name, чтобы проще вытаскивать инвентарь или делать join с таблицей merchs

Дилемма:
Как реализовать перевод денег? Надо сделать за транзу 3 действия: снятие со счета, добавление на счет, встаква записи о транзе

Дилемма:
Может ли юзер несолько раз купить один и тот же мерч. Сделал такую возможность'

Сохранение паролей в шифрованном виде

При добавлении траназаций надо брать id получателя из другой таблицы. Решил делать через CTE
